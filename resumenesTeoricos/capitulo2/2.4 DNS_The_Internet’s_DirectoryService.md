
# 2.4 DNS — El “servicio de directorio” de Internet

DNS (Domain Name System) es como la guía telefónica de Internet: traduce **nombres fáciles** (p. ej., `www.fi.uba.ar`) a **direcciones IP** que entienden las máquinas (p. ej., `157.92.x.y`). Es **distribuido, jerárquico, cachéado** y, en la práctica, es crítico para que todo funcione rápido y bien.

---

## 2.4.1 Servicios que brinda DNS

1. **Resolución nombre → IP (lo básico)**

   * Dado un **hostname** (`www.ejemplo.com`), te devuelve su **IP** (A/AAAA).
   * Ej.: tu navegador pregunta “¿qué IP tiene `www.wikipedia.org`?” y DNS responde con una o varias IP.

2. **Alias de host (host aliasing)**

   * Permite tener nombres “lindos” apuntando al **nombre canónico** del servidor.
   * Se usa **CNAME**.
   * Ej.: `www.mimarca.com` → `srv-123.d1.hosting.net`.

3. **Alias de correo (mail server aliasing)**

   * Un dominio puede declarar **qué servidor maneja su correo**.
   * Se usa **MX** (Mail eXchanger).
   * Ej.: `fi.uba.ar` → `mx1.proveedor.com`.

4. **Distribución de carga (load distribution)**

   * Un mismo nombre puede tener **múltiples A/AAAA** (round-robin) para repartir tráfico.
   * También se usa en **CDNs**: darte la IP “más cercana” o menos cargada.

5. **Búsqueda inversa (IP → nombre)**

   * Con **PTR** en los dominios especiales `in-addr.arpa` (IPv4) o `ip6.arpa` (IPv6).

> Bonus habituales:
>
> * **TXT** para políticas/verificaciones (SPF, DKIM, verificación de dominios).
> * **SRV/NAPTR** para ubicar servicios específicos (VoIP, SIP, etc.).

---

## 2.4.2 Visión general de cómo funciona DNS

### La arquitectura (en capas jerárquicas)

* **Cliente/Stub resolver**: tu SO/navegador que pregunta.
* **Resolvedor recursivo local**: típico de tu ISP o de tu empresa (`8.8.8.8` si usás Google DNS, por ejemplo). Hace “el trabajo pesado”.
* **Servidores raíz (root)**: saben dónde están los TLD; hay muchos réplicados por **anycast**.
* **Servidores TLD**: `.com`, `.org`, `.ar`, etc.
* **Servidores autoritativos**: los que **saben de verdad** la info de `ejemplo.com` (propios del dominio o de su proveedor DNS).

### Flujo típico (iterativo desde el recursor; recursivo visto por el cliente)

1. Tu compu pregunta al **resolvedor local**: “¿IP de `www.ejemplo.com`?” (recursiva).
2. El **resolvedor** va a **root**: “¿quién sabe de `.com`?” → le devuelven TLD `.com`.
3. Va al **TLD `.com`**: “¿quién sabe de `ejemplo.com`?” → le devuelven los **NS autoritativos** de `ejemplo.com` (+ “glue” A si hace falta).
4. Va al **autoritativo de `ejemplo.com`**: “¿IP de `www.ejemplo.com`?” → devuelve la **A/AAAA** (o un **CNAME** y luego su A/AAAA).
5. El **resolvedor** **cachéa** la respuesta (según **TTL**) y te contesta.

### Caching & TTL

* Cada respuesta tiene **TTL** (segundos a guardar en caché).
* **Acelera** futuras consultas y **reduce** tráfico global.
* **Negative caching**: también se cachéan “no existe” por un tiempo.

### Tolerancia a fallas y performance

* Jerarquía + **replicación** + **anycast** en root/TLD → alta disponibilidad.
* **Caché** en todos lados → latencias bajas la mayor parte del tiempo.

> Notas de transporte:
>
> * DNS usa **UDP/53** por defecto (rápido y liviano).
> * Puede usar **TCP/53** (respuestas grandes, DNSSEC, zone transfers).
> * **EDNS(0)** permite respuestas UDP mayores a 512 bytes.

---

## 2.4.3 Registros y mensajes DNS

### Los Resource Records (RR)

Un RR tiene la forma general:
**(NAME, TYPE, VALUE, TTL, CLASS)** — normalmente CLASS = `IN`.

Tipos más comunes (con ejemplos):

* **A**: `www.ejemplo.com. 300 IN A 203.0.113.10`

  * Nombre → IPv4.
* **AAAA**: `www.ejemplo.com. 300 IN AAAA 2001:db8::10`

  * Nombre → IPv6.
* **CNAME**: `www.mimarca.com. 3600 IN CNAME web-frontend-1.cdn.net.`

  * Alias → nombre canónico (luego se resuelve ese nombre a A/AAAA).
* **NS**: `ejemplo.com. 86400 IN NS ns1.proveedor-dns.net.`

  * Declara los **autoritativos** de un dominio.
* **MX**: `ejemplo.com. 3600 IN MX 10 mx1.mailhost.net.`

  * Servidores de correo (el número es prioridad).
* **PTR**: `10.113.0.203.in-addr.arpa. 86400 IN PTR host-10.ejemplo.com.`

  * Inversa: IP → Nombre.
* **SOA**: `ejemplo.com. 86400 IN SOA ns1... (serial, refresh, retry, expire, minimum)`

  * Metadata de la **zona** (primario/secundario, tiempos).
* **TXT**: `ejemplo.com. 300 IN TXT "v=spf1 include:_spf.google.com ~all"`

  * Texto arbitrario (SPF, verificaciones).
* **SRV**: `_sip._tcp.ejemplo.com. 3600 IN SRV 10 60 5060 sipserver.ejemplo.com.`

  * Dónde vive un **servicio** (puerto, prioridad, weight).

> **Reglas útiles:**
>
> * Un **CNAME** no debe coexistir con otros tipos para el **mismo nombre** (salvo excepciones controladas).
> * **Glue records**: A/AAAA de los NS cuando pertenecen **dentro** del mismo dominio, para evitar bucles (se ponen en la sección “Additional”).

### Formato de mensajes DNS

Todos los mensajes (consulta y respuesta) tienen la **misma estructura**:

1. **Header (12 bytes)**

   * **ID** (identificador de la consulta).
   * **Flags**:

     * `QR` (0 consulta / 1 respuesta)
     * `OPCODE` (normalmente 0 = estándar)
     * `AA` (authoritative answer)
     * `TC` (truncated)
     * `RD` (recursion desired)
     * `RA` (recursion available)
     * `RCODE` (código de retorno: 0 OK, 3 NXDOMAIN, etc.)
   * **QDCOUNT/ANCOUNT/NSCOUNT/ARCOUNT**: cuántos registros en cada sección.

2. **Question Section**

   * **QNAME** (nombre consultado), **QTYPE** (A, AAAA, MX, …), **QCLASS** (IN).

3. **Answer Section**

   * RRs con la **respuesta** a la pregunta.

4. **Authority Section**

   * RRs con **NS** que dicen quién es autoritativo para el dominio consultado.

5. **Additional Section**

   * RRs de apoyo, típicamente **A/AAAA** (glue) para los NS o registros útiles (p. ej., la A del host de un MX).

### Ejemplo (flujo común)

* **Consulta**: `QNAME=www.ejemplo.com, QTYPE=A`
* **Respuesta** (posible):

  * **Answer**:

    * `www.ejemplo.com. 300 IN CNAME web1.cdn.net.`
    * `web1.cdn.net. 60 IN A 203.0.113.10`
  * **Authority**:

    * `ejemplo.com. 86400 IN NS ns1.proveedor-dns.net.`
    * `ejemplo.com. 86400 IN NS ns2.proveedor-dns.net.`
  * **Additional**:

    * `ns1.proveedor-dns.net. 86400 IN A 192.0.2.53` (glue)
    * `ns2.proveedor-dns.net. 86400 IN A 192.0.2.54`

---

## Tips de práctica y entendimiento

* **¿Por qué a veces cambia la IP de un sitio?**
  Por **load balancing**, CDNs o cambios de infraestructura. El **TTL** controla cuánto tarda en “propagarse” el cambio.

* **¿Por qué existe el caching?**
  Porque sin caché, cada clic tendría que recorrer root → TLD → autoritativo y la web sería muchísimo más lenta.

* **¿Cuándo se usa TCP en DNS?**
  Respuestas grandes (DNSSEC, muchas RRs, truncación `TC=1`) o **zone transfers** (AXFR/IXFR) entre autoritativos.

* **¿DNS es seguro?**
  Por defecto no verifica autenticidad. Para eso existe **DNSSEC** (agrega firmas RRSIG/DNSKEY) y también **DoT/DoH** para cifrar el transporte (no cambian el modelo de datos).

