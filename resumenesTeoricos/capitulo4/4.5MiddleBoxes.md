## **4.5 Middleboxes**

Un **middlebox** es un dispositivo de red que **no es un router clásico**, pero que igual interviene en el camino de los paquetes para aplicar reglas o funciones adicionales.

* Mientras que un router solo se encarga de **forwarding**, los middleboxes **modifican o controlan el tráfico**.

Ejemplos de middleboxes:

* **Firewall:** filtra paquetes según reglas de seguridad (ejemplo: bloquear puertos o direcciones).
* **NAT (Network Address Translator):** traduce direcciones privadas ↔ públicas.
* **Load Balancer:** reparte tráfico entre varios servidores para evitar sobrecargas.
* **Proxy:** actúa como intermediario entre cliente y servidor (ejemplo: proxy web para cachear páginas).


Pensá en la seguridad de un recital:

* El router es como el boletero, solo chequea tu entrada y te deja pasar.
* El middlebox es como el guardia que además revisa tu mochila, te saca cosas prohibidas o te manda por otra puerta si sos VIP.


## **4.6 Summary**

El resumen del capítulo 4 marca lo más importante de la **capa de red**:

1. La capa de red se encarga de llevar paquetes del origen al destino a través de routers.
2. Se diferencian **forwarding** (acción inmediata) y **routing** (cálculo de rutas).
3. Los routers tienen 4 partes: input ports, switching fabric, output ports y procesador.
4. El protocolo IP define el formato del datagrama y el direccionamiento.
5. IPv4 está limitado en direcciones → por eso existen NAT e IPv6.
6. SDN separa el plano de control y de datos, permitiendo reglas flexibles con match + action.
7. Middleboxes agregan funciones adicionales en el camino (firewalls, load balancers, etc.).

 **Ejemplo** Todo este capítulo es como organizar un viaje en bondi:

* La capa de red es la empresa de colectivos.
* Forwarding es el colectivero manejando.
* Routing es el mapa que le dice qué calles tomar.
* IP es el sistema de direcciones de casas.
* NAT es como un edificio con un portero eléctrico único.
* IPv6 es como pasar de pocas patentes a infinitas.
* SDN es tener un jefe central que decide las rutas.
* Middleboxes son como los controles de seguridad extra en la terminal.



## **Homework Problems and Questions**

En esta parte, el libro suele dar **preguntas teóricas y ejercicios prácticos** para afianzar lo visto. Algunos típicos son:

* Dibujar el formato de un datagrama IPv4 y explicar cada campo.
* Calcular el rango de direcciones de una subred con máscara `/24`.
* Explicar cómo funciona NAT con varios clientes y un servidor.
* Comparar IPv4 con IPv6 (tamaño, formato, ventajas).
* Describir la diferencia entre **data plane** y **control plane**.
* Dar ejemplos de middleboxes y qué problemas pueden traer (por ejemplo, romper la transparencia de extremo a extremo).



## **Wireshark Lab: IP**

En este laboratorio se usa **Wireshark** (analizador de tráfico) para capturar y estudiar paquetes IP.
Lo que te piden normalmente es:

1. Capturar tráfico de tu máquina (ejemplo: cargando una página web).
2. Analizar el **header de un datagrama IPv4**: versión, longitud, TTL, protocolo, dirección origen/destino.
3. Ver cómo cambia el TTL en cada salto (disminuye en cada router).
4. Observar cómo un paquete fragmentado se ve dividido en varios datagramas.
5. Comparar distintos tipos de tráfico (por ejemplo, HTTP vs ICMP).

 Es como usar rayos X para mirar dentro de las cartas que viajan por el correo. Podés ver quién la envía, a quién va, cuánto mide y cuántas veces pasa por manos intermedias antes de llegar.

---

 **En Sintesis:**

* **Middleboxes:** dispositivos que modifican/controlan tráfico (firewalls, NAT, proxies).
* **Summary:** repaso de forwarding, routing, IPv4, NAT, IPv6, SDN, middleboxes.
* **Homework:** preguntas de aplicación (formato IP, subredes, NAT, IPv4 vs IPv6).
* **Wireshark Lab:** práctica con captura de paquetes para ver campos del header y cómo cambia en tránsito.

