## **4.2 What’s Inside a Router?**

Un router no es solo una “caja mágica” que conecta redes, adentro tiene varios componentes que cumplen funciones específicas. Se puede dividir en 4 bloques principales:

1. **Puertos de entrada (input ports)**
2. **La tela de conmutación (switching fabric)**
3. **Puertos de salida (output ports)**
4. **El procesador de enrutamiento**

 **Ejemplo:** Pensá en una terminal de colectivos.

* Los pasajeros (paquetes) entran por distintas puertas (input ports).
* En el hall central (switching fabric) se decide a qué andén van.
* Los pasajeros esperan y salen por el andén correcto (output ports).
* El jefe de estación (procesador) se encarga de que las rutas estén claras.

---

## **4.2.1 Input Port Processing and Destination-Based Forwarding**

Cuando un paquete llega a un **puerto de entrada**, lo primero que hace el router es:

1. Revisar la dirección de destino (IP).
2. Consultar su **tabla de reenvío** (forwarding table) para decidir a dónde mandarlo.
3. Enviar el paquete hacia la **switching fabric**.

* Se usa **destination-based forwarding** → se reenvía solo mirando la dirección de destino.
* En redes más modernas también puede haber **generalized forwarding** → se miran otros campos del paquete, como el tipo de servicio.

 **Ejemplo:** Es como cuando un pasajero llega a Retiro con un boleto: el guardia mira el destino (Mar del Plata) y lo manda al andén 34, sin fijarse en nada más.

---

## **4.2.2 Switching**

Es el corazón del router: la **switching fabric** es la parte que conecta los puertos de entrada con los de salida.
Hay varias tecnologías:

1. **Memoria:** el procesador central copia el paquete de entrada a salida (lento).
2. **Bus compartido:** todos los puertos comparten un “camino único”, pero solo uno puede usarlo a la vez.
3. **Red de interconexión:** más escalable, conecta entradas y salidas en paralelo (tipo telaraña).

 **Ejemplo:** Imaginate un hall con varios pasillos. En los primeros diseños había un solo pasillo, entonces si había mucha gente se armaba cola. En los modernos hay muchos caminos en paralelo, entonces varios pasajeros pueden moverse al mismo tiempo.

---

## **4.2.3 Output Port Processing**

Cuando el paquete ya cruzó la switching fabric y llegó a su **puerto de salida**, pasan estas cosas:

1. Se guardan los paquetes en un buffer si el enlace está ocupado.
2. Se programan para ser enviados en orden.
3. Se aplican políticas (por ejemplo, priorizar paquetes de voz sobre descargas).

 **Ejemplo:** Es como llegar al andén: si el micro todavía no salió, te hacés una fila (buffer). Cuando abre la puerta, los pasajeros van subiendo según el orden y la prioridad.

---

## **4.2.4 Where Does Queuing Occur?**

Las **colas (queues)** aparecen en dos lugares:

1. **En la entrada (input queuing):** si la switching fabric está ocupada, los paquetes esperan en el puerto de entrada.

   * Problema: **Head-of-the-line (HOL) blocking** → si el primer paquete está trabado, los que vienen atrás no pueden avanzar aunque tengan otro destino.
2. **En la salida (output queuing):** si llegan muchos paquetes al mismo puerto de salida, se acumulan ahí.

 **Ejemplo:**

* Input queuing → como en la boletería: si la primera persona no termina de pagar, todos atrás esperan aunque vayan a otro lado.
* Output queuing → como cuando hay mucha gente queriendo subir al mismo micro: se arma cola en el andén.

---

## **4.2.5 Packet Scheduling**

Cuando hay muchos paquetes esperando en un puerto de salida, el router necesita decidir **en qué orden los manda**.
Hay varios algoritmos:

* **First-In First-Out (FIFO):** el primero que llegó, primero que sale.
* **Priority Scheduling:** los paquetes con prioridad (ejemplo: llamadas VoIP) van primero.
* **Round Robin:** se turnan entre diferentes flujos de tráfico.
* **Weighted Fair Queuing (WFQ):** parecido al round robin, pero con diferentes “pesos” según la importancia.

 **Ejemplo:**

* FIFO → como la fila del súper, atendés al que llegó primero.
* Prioridad → si viene alguien con una urgencia, lo dejás pasar antes.
* Round Robin → como cuando en el banco hay varias filas y atienden de a uno de cada fila.
* WFQ → es como si le dieras más turnos a las filas con gente que necesita salir más rápido.

---

**Resumen:**

* Los routers tienen **entrada, conmutación, salida y procesador de control**.
* En **input ports** se mira la dirección de destino y se decide por dónde ir.
* En la **switching fabric** se conecta la entrada con la salida.
* En **output ports** se almacenan y ordenan los paquetes para su envío.
* Las **colas** pueden armarse tanto en la entrada como en la salida.
* El **scheduling** define en qué orden se envían los paquetes cuando hay congestión.

---

