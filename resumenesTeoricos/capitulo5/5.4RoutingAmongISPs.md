# 5.4 Routing Among the ISPs: BGP

Cuando un paquete se mueve **dentro de un AS**, OSPF (u otro protocolo intra-AS) decide la ruta. Pero para moverse **entre diferentes ASs**, necesitamos un protocolo común a todos. Ese es el **Border Gateway Protocol (BGP)**, el estándar de facto para el enrutamiento inter-AS.

BGP es crítico porque:

* Es lo que **mantiene unida a Internet** (junto con IP).
* Funciona de forma **descentralizada y asincrónica**, parecido al *distance-vector*, pero con más atributos y políticas.



## 5.4.1 The Role of BGP

BGP tiene dos responsabilidades principales:

1. **Obtener información de alcanzabilidad de prefijos** (CIDR). Ej: “existe el prefijo 138.16.68/22 en este AS”.
2. **Determinar la mejor ruta** entre múltiples opciones.

 Los routers en BGP no manejan destinos individuales, sino **prefijos** (bloques de direcciones).


## 5.4.2 Advertising BGP Route Information

* Se distinguen dos tipos de routers:

  * **Gateway routers**: están en el borde del AS, conectados a otros ASs.
  * **Internal routers**: sólo se conectan dentro del mismo AS.

* **Tipos de conexiones BGP**:

  * **eBGP** (entre ASs).
  * **iBGP** (dentro del mismo AS).

* La info se propaga así: AS3 anuncia a AS2 “yo tengo el prefijo x”. AS2 reanuncia a AS1 “podés llegar a x pasando por mí y luego AS3”.



## 5.4.3 Determining the Best Routes

Cada anuncio BGP viene con **atributos** (path attributes). Los más importantes:

* **AS-PATH**: lista de ASs por los que pasa el anuncio (sirve para elegir rutas cortas y evitar loops).
* **NEXT-HOP**: dirección IP del router de inicio del camino.

El algoritmo de selección de rutas sigue pasos:

1. Primero se respeta la **política local** (atributo *local preference*).
2. Luego se elige la ruta con **menor AS-PATH** (menos saltos de AS).
3. Si persiste empate, se aplica **hot potato routing** (entregar el paquete lo más rápido posible a otro AS, usando el router más cercano).
4. Finalmente, se usan IDs de BGP como desempate.

 **Hot potato routing:** es como sacarte de encima la papa caliente: mandás el paquete al vecino más próximo y listo, sin preocuparte del trayecto posterior.


## 5.4.4 IP-Anycast

* BGP también sirve para **servicios de anycast**: un mismo **IP address** es anunciado desde múltiples lugares del mundo.
* Cada router decide el “mejor” camino y el usuario termina conectado al servidor **más cercano**.
* Usado en:

  * **DNS root servers** (los 13 IPs que en realidad corresponden a cientos de máquinas en todo el planeta).
  * CDNs (aunque menos, porque cambios de rutas en BGP pueden romper sesiones TCP).



## 5.4.5 Routing Policy

En inter-AS **no manda la performance técnica, manda la política y la economía**:

* Los ISPs definen qué rutas aceptan, qué tráfico transportan y cuáles no.
* Ejemplo: un ISP no quiere ser “camino gratis” entre otros dos proveedores.
* Esto se implementa **anunciando selectivamente rutas**: un AS puede ocultar ciertas rutas a otros.
* Las políticas dependen de contratos comerciales (clientes, proveedores, peers).

 Regla de oro: el tráfico por un backbone ISP debe tener origen o destino en **clientes** de ese ISP (si no, es un “free ride”).



## 5.4.6 Putting the Pieces Together: Obtaining Internet Presence

Supongamos que creás una empresa y querés poner tu web y mail online:

1. **Conectarte a un ISP** → contrato de acceso + rango de direcciones IP (ej. un /24 con 256 direcciones).
2. **Asignar direcciones IP** a tus servidores (web, mail, DNS, gateway).
3. **Registrar tu dominio** (ej. `mipyme.com`). El registrador mete en el DNS tu servidor de nombres con su IP.
4. **Configurar tu DNS** con las entradas (`www.mipyme.com → IP`).
5. Tu ISP anunciará tu prefijo en BGP para que el resto de Internet sepa llegar.



## Resumen

* **BGP** es el protocolo que une los miles de ASs.
* Anuncia **prefijos CIDR**, no hosts individuales.
* Usa **atributos** como AS-PATH, NEXT-HOP y local preference para elegir rutas.
* Soporta **IP-anycast** (DNS, CDNs).
* Las decisiones de enrutamiento inter-AS están dominadas por **política comercial**, no por performance.
* Para tener “Internet presence” necesitás IPs, dominio, DNS y que tu ISP anuncie tus rutas por BGP.

